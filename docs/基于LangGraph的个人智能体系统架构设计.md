# åŸºäºLangGraphçš„ä¸ªäººæ™ºèƒ½ä½“ç³»ç»Ÿæ¶æ„è®¾è®¡

## ğŸ“‹ æ•´ä½“æ¶æ„è®¾è®¡

### 1. ç³»ç»Ÿæ¶æ„å›¾

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    ç”¨æˆ·äº¤äº’å±‚                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ æ‰‹æœºAPP  â”‚  â”‚ å¾®ä¿¡å°ç¨‹åºâ”‚  â”‚ Webç•Œé¢  â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    APIç½‘å…³å±‚                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  FastAPI / Flask REST API + WebSocket                â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              LangGraph æ™ºèƒ½ä½“ç¼–æ’å±‚                          â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ–°é—»Agentâ”‚  â”‚å†™ä½œAgent â”‚  â”‚è§†é¢‘Agent â”‚  â”‚æ—¥ç¨‹Agent â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚          LangGraph StateGraph åè°ƒå™¨                  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    æœåŠ¡å±‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ LLM API  â”‚  â”‚ æ¶ˆæ¯é˜Ÿåˆ—  â”‚  â”‚ ä»»åŠ¡è°ƒåº¦  â”‚  â”‚ æ•°æ®å­˜å‚¨  â”‚  â”‚
â”‚  â”‚(GLM/GPT) â”‚  â”‚ (Redis)  â”‚  â”‚(Celery)  â”‚  â”‚(PostgreSQLâ”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                  å¤–éƒ¨æœåŠ¡é›†æˆå±‚                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚å…¬ä¼—å·API â”‚  â”‚å°çº¢ä¹¦API â”‚  â”‚ è§†é¢‘å¹³å° â”‚  â”‚ æ–°é—»API  â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


## ğŸ› ï¸ æŠ€æœ¯æ ˆé€‰æ‹©

### æ ¸å¿ƒæŠ€æœ¯æ ˆ

```yaml
æ™ºèƒ½ä½“æ¡†æ¶:
  - LangGraph: æ™ºèƒ½ä½“ç¼–æ’å’ŒçŠ¶æ€ç®¡ç†
  - LangChain: LLMå·¥å…·é›†æˆ
  - GLM-4: ä¸»è¦LLMæ¨¡å‹

åç«¯æœåŠ¡:
  - Python 3.11+
  - FastAPI: REST API + WebSocket
  - Celery: å¼‚æ­¥ä»»åŠ¡è°ƒåº¦
  - Redis: æ¶ˆæ¯é˜Ÿåˆ— + ç¼“å­˜
  - PostgreSQL: æŒä¹…åŒ–å­˜å‚¨

éƒ¨ç½²æ–¹æ¡ˆ:
  - Docker + Docker Compose
  - äº‘æœåŠ¡å™¨ (é˜¿é‡Œäº‘/è…¾è®¯äº‘/AWS)
  - Nginx: åå‘ä»£ç†

å‰ç«¯äº¤äº’:
  - å¾®ä¿¡å°ç¨‹åº (æ‰‹æœºç«¯)
  - Web Dashboard (ç”µè„‘ç«¯)
  - Serveré…±/PushPlus: æ¶ˆæ¯æ¨é€
```

## ğŸ“ é¡¹ç›®ç»“æ„
Zzy_Personal_Agent/
â”œâ”€â”€ agents/                    # LangGraphæ™ºèƒ½ä½“
â”‚   â”œâ”€â”€ init .py
â”‚   â”œâ”€â”€ news_agent.py         # æ–°é—»çƒ­ç‚¹Agent
â”‚   â”œâ”€â”€ writing_agent.py      # å†™ä½œAgent
â”‚   â”œâ”€â”€ video_agent.py        # è§†é¢‘åˆ¶ä½œAgent
â”‚   â”œâ”€â”€ schedule_agent.py     # æ—¥ç¨‹ç®¡ç†Agent
â”‚   â””â”€â”€ orchestrator.py       # LangGraphç¼–æ’å™¨
â”œâ”€â”€ api/                       # APIæœåŠ¡
â”‚   â”œâ”€â”€ init .py
â”‚   â”œâ”€â”€ main.py               # FastAPIä¸»åº”ç”¨
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ chat.py
â”‚   â”‚   â”œâ”€â”€ tasks.py
â”‚   â”‚   â””â”€â”€ webhooks.py
â”‚   â””â”€â”€ websocket.py          # WebSocketè¿æ¥
â”œâ”€â”€ tasks/                     # Celeryä»»åŠ¡
â”‚   â”œâ”€â”€ init .py
â”‚   â”œâ”€â”€ celery_app.py
â”‚   â”œâ”€â”€ news_tasks.py
â”‚   â”œâ”€â”€ writing_tasks.py
â”‚   â””â”€â”€ video_tasks.py
â”œâ”€â”€ services/                  # å¤–éƒ¨æœåŠ¡é›†æˆ
â”‚   â”œâ”€â”€ init .py
â”‚   â”œâ”€â”€ wechat_mp.py          # å…¬ä¼—å·API
â”‚   â”œâ”€â”€ xiaohongshu.py        # å°çº¢ä¹¦API
â”‚   â”œâ”€â”€ video_platform.py     # è§†é¢‘å¹³å°API
â”‚   â””â”€â”€ news_api.py           # æ–°é—»API
â”œâ”€â”€ models/                    # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ init .py
â”‚   â”œâ”€â”€ user.py
â”‚   â”œâ”€â”€ task.py
â”‚   â””â”€â”€ message.py
â”œâ”€â”€ core/                      # æ ¸å¿ƒé…ç½®
â”‚   â”œâ”€â”€ init .py
â”‚   â”œâ”€â”€ config.py             # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ database.py           # æ•°æ®åº“è¿æ¥
â”‚   â””â”€â”€ llm.py                # LLMå®¢æˆ·ç«¯
â”œâ”€â”€ utils/                     # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ init .py
â”‚   â”œâ”€â”€ logger.py
â”‚   â””â”€â”€ helpers.py
â”œâ”€â”€ docker/                    # Dockeré…ç½®
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ docker-compose.yml
â”œâ”€â”€ frontend/                  # å‰ç«¯ä»£ç 
â”‚   â”œâ”€â”€ miniprogram/          # å¾®ä¿¡å°ç¨‹åº
â”‚   â””â”€â”€ web/                  # Webç•Œé¢
â”œâ”€â”€ tests/                     # æµ‹è¯•
â”œâ”€â”€ docs/                      # æ–‡æ¡£
â”‚   â”œâ”€â”€ architecture_design.md
â”‚   â”œâ”€â”€ æ ¸å¿ƒæŠ€æœ¯æ ˆ.yml
â”‚   â””â”€â”€ ç³»ç»Ÿæ¶æ„å›¾01.txt
â”œâ”€â”€ requirements.txt
â”œâ”€â”€ README.md
â””â”€â”€ .env.example


## ğŸš€ æ ¸å¿ƒä»£ç å®ç°

### 1. LangGraph æ™ºèƒ½ä½“ç¼–æ’å™¨

```python
from typing import TypedDict, Annotated
from langgraph.graph import StateGraph, END
from langchain_core.messages import HumanMessage, AIMessage
from langchain_zhipu import ChatZhipuAI

class AgentState(TypedDict):
    messages: Annotated[list, "å¯¹è¯å†å²"]
    current_task: str
    task_type: str
    result: str
    next_agent: str

class PersonalAgentOrchestrator:
    def __init__(self):
        self.llm = ChatZhipuAI(model="glm-4", temperature=0.7)
        self.graph = self._build_graph()
    
    def _build_graph(self):
        workflow = StateGraph(AgentState)
        
        # æ·»åŠ èŠ‚ç‚¹
        workflow.add_node("router", self._route_task)
        workflow.add_node("news_agent", self._news_agent)
        workflow.add_node("writing_agent", self._writing_agent)
        workflow.add_node("video_agent", self._video_agent)
        workflow.add_node("schedule_agent", self._schedule_agent)
        
        # è®¾ç½®å…¥å£
        workflow.set_entry_point("router")
        
        # æ·»åŠ è¾¹
        workflow.add_conditional_edges(
            "router",
            self._decide_next_agent,
            {
                "news": "news_agent",
                "writing": "writing_agent",
                "video": "video_agent",
                "schedule": "schedule_agent",
                "end": END
            }
        )
        
        # æ‰€æœ‰agentå®Œæˆåç»“æŸ
        for agent in ["news_agent", "writing_agent", "video_agent", "schedule_agent"]:
            workflow.add_edge(agent, END)
        
        return workflow.compile()
    
    def _route_task(self, state: AgentState):
        """è·¯ç”±ä»»åŠ¡åˆ°åˆé€‚çš„Agent"""
        task = state["current_task"]
        prompt = f"""åˆ†æä»¥ä¸‹ä»»åŠ¡ï¼Œåˆ¤æ–­åº”è¯¥ç”±å“ªä¸ªæ™ºèƒ½ä½“å¤„ç†ï¼š
        
ä»»åŠ¡ï¼š{task}

å¯é€‰æ™ºèƒ½ä½“ï¼š
- news: æ–°é—»çƒ­ç‚¹ç›¸å…³
- writing: å†™ä½œç›¸å…³ï¼ˆå…¬ä¼—å·ã€å°çº¢ä¹¦ç­‰ï¼‰
- video: è§†é¢‘åˆ¶ä½œç›¸å…³
- schedule: æ—¥ç¨‹ç®¡ç†ç›¸å…³

åªè¿”å›æ™ºèƒ½ä½“åç§°ï¼Œä¸è¦å…¶ä»–å†…å®¹ã€‚"""
        
        response = self.llm.invoke(prompt)
        state["task_type"] = response.content.strip().lower()
        return state
    
    def _decide_next_agent(self, state: AgentState):
        return state.get("task_type", "end")
    
    async def run(self, task: str):
        """è¿è¡Œæ™ºèƒ½ä½“"""
        initial_state = {
            "messages": [],
            "current_task": task,
            "task_type": "",
            "result": "",
            "next_agent": ""
        }
        result = await self.graph.ainvoke(initial_state)
        return result
```

### 2. æ–°é—»Agentå®ç°

```python
from langchain_core.tools import Tool
from langchain.agents import create_openai_functions_agent
from services.news_api import NewsAPIService

class NewsAgent:
    def __init__(self):
        self.llm = ChatZhipuAI(model="glm-4")
        self.news_service = NewsAPIService()
        self.tools = self._create_tools()
    
    def _create_tools(self):
        return [
            Tool(
                name="fetch_hot_news",
                description="è·å–å½“å‰çƒ­ç‚¹æ–°é—»",
                func=self._fetch_hot_news
            ),
            Tool(
                name="summarize_news",
                description="æ€»ç»“æ–°é—»è¦ç‚¹",
                func=self._summarize_news
            ),
            Tool(
                name="push_notification",
                description="æ¨é€æ¶ˆæ¯åˆ°ç”¨æˆ·",
                func=self._push_notification
            )
        ]
    
    def _fetch_hot_news(self, category: str = "ç§‘æŠ€"):
        """è·å–çƒ­ç‚¹æ–°é—»"""
        news = self.news_service.get_hot_news(category)
        return news
    
    def _summarize_news(self, news_content: str):
        """ä½¿ç”¨LLMæ€»ç»“æ–°é—»"""
        prompt = f"è¯·æ€»ç»“ä»¥ä¸‹æ–°é—»çš„è¦ç‚¹ï¼š\n\n{news_content}"
        return self.llm.invoke(prompt).content
    
    def _push_notification(self, message: str):
        """æ¨é€åˆ°ç”¨æˆ·æ‰‹æœº"""
        # ä½¿ç”¨Serveré…±æˆ–PushPlusæ¨é€
        pass
    
    async def run(self, task: str):
        """æ‰§è¡Œæ–°é—»ä»»åŠ¡"""
        # å®ç°æ–°é—»è·å–ã€æ€»ç»“ã€æ¨é€é€»è¾‘
        pass
```

### 3. å†™ä½œAgentå®ç°

```python
class WritingAgent:
    def __init__(self):
        self.llm = ChatZhipuAI(model="glm-4", temperature=0.8)
        self.platforms = {
            "wechat": WeChatMPService(),
            "xiaohongshu": XiaoHongShuService()
        }
    
    async def write_article(self, topic: str, platform: str = "wechat"):
        """å†™æ–‡ç« """
        # 1. ç”Ÿæˆå¤§çº²
        outline = await self._generate_outline(topic)
        
        # 2. ç”Ÿæˆæ­£æ–‡
        article = await self._generate_content(outline, platform)
        
        # 3. ä¼˜åŒ–æ ‡é¢˜
        title = await self._generate_title(topic, article)
        
        # 4. å‘å¸ƒåˆ°å¹³å°
        if platform in self.platforms:
            result = await self.platforms[platform].publish(
                title=title,
                content=article
            )
            return result
        
        return {"title": title, "content": article}
    
    async def _generate_outline(self, topic: str):
        prompt = f"ä¸ºä¸»é¢˜'{topic}'ç”Ÿæˆä¸€ä¸ªè¯¦ç»†çš„æ–‡ç« å¤§çº²"
        return self.llm.invoke(prompt).content
    
    async def _generate_content(self, outline: str, platform: str):
        style_guide = {
            "wechat": "å…¬ä¼—å·é£æ ¼ï¼šæ­£å¼ã€ä¸“ä¸šã€æœ‰æ·±åº¦",
            "xiaohongshu": "å°çº¢ä¹¦é£æ ¼ï¼šè½»æ¾ã€æ´»æ³¼ã€emojiä¸°å¯Œ"
        }
        
        prompt = f"""æ ¹æ®ä»¥ä¸‹å¤§çº²å†™ä¸€ç¯‡æ–‡ç« ï¼š
        
å¤§çº²ï¼š
{outline}

é£æ ¼è¦æ±‚ï¼š{style_guide.get(platform, 'é€šç”¨é£æ ¼')}"""
        
        return self.llm.invoke(prompt).content
```

### 4. Celeryä»»åŠ¡è°ƒåº¦

```python
from celery import Celery
from celery.schedules import crontab

app = Celery('personal_agent', broker='redis://localhost:6379/0')

@app.on_after_configure.connect
def setup_periodic_tasks(sender, **kwargs):
    # æ¯å¤©æ—©ä¸Š8ç‚¹æ¨é€æ–°é—»
    sender.add_periodic_task(
        crontab(hour=8, minute=0),
        morning_news_push.s(),
        name='morning-news-push'
    )
    
    # æ¯å°æ—¶æ£€æŸ¥æ—¥ç¨‹
    sender.add_periodic_task(
        crontab(minute=0),
        check_schedule.s(),
        name='hourly-schedule-check'
    )

@app.task
def morning_news_push():
    """æ—©æ™¨æ–°é—»æ¨é€"""
    from agents.news_agent import NewsAgent
    agent = NewsAgent()
    # è·å–çƒ­ç‚¹æ–°é—»å¹¶æ¨é€
    news = agent.fetch_hot_news()
    summary = agent.summarize_news(news)
    agent.push_notification(summary)

@app.task
def check_schedule():
    """æ£€æŸ¥æ—¥ç¨‹æé†’"""
    from agents.schedule_agent import ScheduleAgent
    agent = ScheduleAgent()
    agent.check_and_remind()
```

### 5. FastAPIä¸»åº”ç”¨

```python
from fastapi import FastAPI, WebSocket
from fastapi.middleware.cors import CORSMiddleware
from agents.orchestrator import PersonalAgentOrchestrator

app = FastAPI(title="Personal Agent System")

# CORSé…ç½®
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],
    allow_credentials=True,
    allow_methods=["*"],
    allow_headers=["*"],
)

orchestrator = PersonalAgentOrchestrator()

@app.post("/api/chat")
async def chat(message: str):
    """å¯¹è¯æ¥å£"""
    result = await orchestrator.run(message)
    return {"result": result}

@app.post("/api/task/create")
async def create_task(task: dict):
    """åˆ›å»ºä»»åŠ¡"""
    # æäº¤åˆ°Celeryé˜Ÿåˆ—
    from tasks.celery_app import process_task
    task_id = process_task.delay(task).id
    return {"task_id": task_id}

@app.websocket("/ws/{client_id}")
async def websocket_endpoint(websocket: WebSocket, client_id: str):
    """WebSocketè¿æ¥ï¼Œå®æ—¶é€šä¿¡"""
    await websocket.accept()
    while True:
        data = await websocket.receive_text()
        result = await orchestrator.run(data)
        await websocket.send_json(result)
```

### 6. Dockeréƒ¨ç½²é…ç½®

```yaml
version: '3.8'

services:
  api:
    build: .
    ports:
      - "8000:8000"
    environment:
      - ZHIPU_API_KEY=${ZHIPU_API_KEY}
      - REDIS_URL=redis://redis:6379/0
      - DATABASE_URL=postgresql://user:pass@db:5432/agent_db
    depends_on:
      - redis
      - db
    volumes:
      - ./data:/app/data
  
  celery_worker:
    build: .
    command: celery -A tasks.celery_app worker --loglevel=info
    depends_on:
      - redis
    environment:
      - ZHIPU_API_KEY=${ZHIPU_API_KEY}
  
  celery_beat:
    build: .
    command: celery -A tasks.celery_app beat --loglevel=info
    depends_on:
      - redis
  
  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"
  
  db:
    image: postgres:15
    environment:
      - POSTGRES_DB=agent_db
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=pass
    volumes:
      - postgres_data:/var/lib/postgresql/data
  
  nginx:
    image: nginx:alpine
    ports:
      - "80:80"
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
    depends_on:
      - api

volumes:
  postgres_data:
```

## ğŸ“± æ‰‹æœºäº¤äº’æ–¹æ¡ˆ

### æ–¹æ¡ˆ1ï¼šå¾®ä¿¡å°ç¨‹åº

```javascript
// miniprogram/pages/index/index.js
Page({
  data: {
    messages: []
  },
  
  onLoad() {
    this.connectWebSocket()
  },
  
  connectWebSocket() {
    wx.connectSocket({
      url: 'wss://your-domain.com/ws/' + wx.getStorageSync('userId')
    })
    
    wx.onSocketMessage(res => {
      const data = JSON.parse(res.data)
      this.setData({
        messages: [...this.data.messages, data]
      })
    })
  },
  
  sendMessage(e) {
    const message = e.detail.value
    wx.sendSocketMessage({
      data: JSON.stringify({ message })
    })
  }
})
```

### æ–¹æ¡ˆ2ï¼šæ¶ˆæ¯æ¨é€

```python
import requests

class PushService:
    """Serveré…±æ¨é€æœåŠ¡"""
    
    def __init__(self, send_key: str):
        self.send_key = send_key
        self.api_url = f"https://sctapi.ftqq.com/{send_key}.send"
    
    def push(self, title: str, content: str):
        """æ¨é€æ¶ˆæ¯åˆ°å¾®ä¿¡"""
        data = {
            "title": title,
            "desp": content
        }
        response = requests.post(self.api_url, data=data)
        return response.json()
```

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. äº‘æœåŠ¡å™¨å‡†å¤‡

```bash
# è´­ä¹°äº‘æœåŠ¡å™¨ï¼ˆæ¨èé…ç½®ï¼‰
# - CPU: 2æ ¸
# - å†…å­˜: 4GB
# - å­˜å‚¨: 50GB SSD
# - å¸¦å®½: 3Mbps
# - ç³»ç»Ÿ: Ubuntu 22.04

# è¿æ¥æœåŠ¡å™¨
ssh root@your-server-ip

# å®‰è£…Docker
curl -fsSL https://get.docker.com | bash
systemctl start docker
systemctl enable docker

# å®‰è£…Docker Compose
curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose
chmod +x /usr/local/bin/docker-compose
```

### 2. éƒ¨ç½²åº”ç”¨

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/yourusername/Zzy_Personal_Agent.git
cd Zzy_Personal_Agent

# é…ç½®ç¯å¢ƒå˜é‡
cp .env.example .env
nano .env  # å¡«å†™APIå¯†é’¥ç­‰é…ç½®

# å¯åŠ¨æœåŠ¡
docker-compose up -d

# æŸ¥çœ‹æ—¥å¿—
docker-compose logs -f

# æ£€æŸ¥æœåŠ¡çŠ¶æ€
docker-compose ps
```

### 3. é…ç½®åŸŸåå’ŒSSL

```bash
# å®‰è£…Nginx
apt install nginx

# é…ç½®åŸŸå
nano /etc/nginx/sites-available/your-domain.com

# ç”³è¯·SSLè¯ä¹¦
apt install certbot python3-certbot-nginx
certbot --nginx -d your-domain.com
```

## ğŸ’° æˆæœ¬ä¼°ç®—

äº‘æœåŠ¡å™¨ï¼ˆé˜¿é‡Œäº‘/è…¾è®¯äº‘ï¼‰:

- 2æ ¸4Gé…ç½®: Â¥100-200/æœˆ
- å¸¦å®½3Mbps: Â¥50/æœˆ
LLM APIè°ƒç”¨:

- GLM-4: Â¥0.1/åƒtokens
- é¢„ä¼°æœˆè°ƒç”¨: Â¥100-300
å…¶ä»–æœåŠ¡:

- åŸŸå: Â¥50/å¹´
- SSLè¯ä¹¦: å…è´¹
æ€»è®¡: Â¥250-550/æœˆ


## ğŸ“Š ç›‘æ§å’Œç»´æŠ¤

```python
# æ·»åŠ å¥åº·æ£€æŸ¥
@app.get("/health")
async def health_check():
    return {
        "status": "healthy",
        "services": {
            "redis": check_redis(),
            "database": check_db(),
            "celery": check_celery()
        }
    }

# æ—¥å¿—è®°å½•
import logging
logging.basicConfig(
    level=logging.INFO,
    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    handlers=[
        logging.FileHandler('agent.log'),
        logging.StreamHandler()
    ]
)
```

## ğŸ¯ ä¸‹ä¸€æ­¥è¡ŒåŠ¨

### 1. ç«‹å³å¼€å§‹

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
cd /Users/andreazhuo/AI/20260215/Zzy_Personal_Agent

# åˆå§‹åŒ–Git
git init

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install langgraph langchain fastapi celery redis
```

### 2. åˆ†é˜¶æ®µå®ç°

- ç¬¬ä¸€å‘¨ï¼šæ­å»ºåŸºç¡€æ¡†æ¶å’ŒLangGraphç¼–æ’
- ç¬¬äºŒå‘¨ï¼šå®ç°æ–°é—»Agentå’Œæ¨é€åŠŸèƒ½
- ç¬¬ä¸‰å‘¨ï¼šå®ç°å†™ä½œAgentå’Œå¹³å°å¯¹æ¥
- ç¬¬å››å‘¨ï¼šéƒ¨ç½²ä¸Šçº¿å’Œæµ‹è¯•

### 3. è·å–APIå¯†é’¥

- GLM API: https://open.bigmodel.cn
- Serveré…±: https://sct.ftqq.com
- æ–°é—»API: https://newsapi.org

## ğŸ“ åŠŸèƒ½æ¸…å•

### æ ¸å¿ƒåŠŸèƒ½
- [ ] æ–°é—»çƒ­ç‚¹æ¨é€
- [ ] å…¬ä¼—å·æ–‡ç« å†™ä½œ
- [ ] å°çº¢ä¹¦å†…å®¹åˆ›ä½œ
- [ ] è§†é¢‘åˆ¶ä½œä¸å‘å¸ƒ
- [ ] æ—¥ç¨‹ç®¡ç†ä¸æé†’

### æ‰©å±•åŠŸèƒ½
- [ ] å­¦ä¹ ç¬”è®°æ•´ç†
- [ ] çŸ¥è¯†åº“ç®¡ç†
- [ ] æ™ºèƒ½é—®ç­”åŠ©æ‰‹
- [ ] æ•°æ®åˆ†æä¸æŠ¥å‘Š
- [ ] è‡ªåŠ¨åŒ–å·¥ä½œæµ

## ğŸ” å®‰å…¨å»ºè®®

1. **APIå¯†é’¥ç®¡ç†**
   - ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨æ•æ„Ÿä¿¡æ¯
   - å®šæœŸè½®æ¢APIå¯†é’¥
   - é™åˆ¶APIè°ƒç”¨é¢‘ç‡

2. **æ•°æ®å®‰å…¨**
   - æ•°æ®åº“å®šæœŸå¤‡ä»½
   - æ•æ„Ÿæ•°æ®åŠ å¯†å­˜å‚¨
   - è®¿é—®æ—¥å¿—å®¡è®¡

3. **ç½‘ç»œå®‰å…¨**
   - ä½¿ç”¨HTTPSåŠ å¯†é€šä¿¡
   - è®¾ç½®é˜²ç«å¢™è§„åˆ™
   - å®šæœŸæ›´æ–°ç³»ç»Ÿè¡¥ä¸

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚éœ€è¿›ä¸€æ­¥å¸®åŠ©ï¼Œå¯ä»¥å‚è€ƒä»¥ä¸‹èµ„æºï¼š
- LangGraphæ–‡æ¡£: https://langchain-ai.github.io/langgraph/
- FastAPIæ–‡æ¡£: https://fastapi.tiangolo.com/
- Celeryæ–‡æ¡£: https://docs.celeryq.dev/
- GLM APIæ–‡æ¡£: https://open.bigmodel.cn/dev/api